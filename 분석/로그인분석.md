# ğŸ”‘ ë¡œê·¸ì¸ í˜ì´ì§€ ë¶„ì„

**ë¶„ì„ ì¼ì‹œ:** 2025-12-02 20:52:57 (KST)  
**ë¶„ì„ ëŒ€ìƒ:** `src/pages/Login.tsx` (316ì¤„)  
**í˜ì´ì§€ ì—­í• :** ì‚¬ìš©ì ì¸ì¦ ë° ë°ì´í„° ë™ê¸°í™”

---

## ğŸ“‹ ê°œìš”

ë¡œê·¸ì¸ í˜ì´ì§€ëŠ” ì‚¬ìš©ì ì¸ì¦ê³¼ ë™ì‹œì— ì—¬ëŸ¬ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë™ê¸°í™”í•˜ëŠ” **ë°ì´í„° ê²Œì´íŠ¸ì›¨ì´** ì—­í• ì„ í•©ë‹ˆë‹¤.

---

## ğŸ”‘ ì£¼ìš” ê¸°ëŠ¥

### 1. ìœ ì—°í•œ ë¡œê·¸ì¸ ì‹œìŠ¤í…œ

```typescript
// 3ê°€ì§€ ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥
const member = getMemberByAnyCredential(input);

ë¡œê·¸ì¸ ë°©ë²•:
- ì´ë¦„ (ì˜ˆ: "í™ê¸¸ë™")
- ì „í™”ë²ˆí˜¸ (ì˜ˆ: "010-1234-5678")
- ì´ë©”ì¼ (ì˜ˆ: "example@email.com")
```

**íŠ¹ì§•:**
- âœ… ë¹„ë°€ë²ˆí˜¸ ì—†ìŒ (ê°„í¸ ë¡œê·¸ì¸)
- âœ… í•˜ë‚˜ì˜ ì •ë³´ë§Œìœ¼ë¡œ ì¸ì¦
- âœ… ìë™ trim() ì²˜ë¦¬

### 2. 3ì¤‘ ë°ì´í„° ë™ê¸°í™”

#### A. íšŒì› ëª©ë¡ ë™ê¸°í™”

```typescript
syncMembersFromSupabase()
// 1. Supabaseì—ì„œ ì „ì²´ íšŒì› ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
// 2. Supabaseë¥¼ source of truthë¡œ ì‚¬ìš©
// 3. LocalStorage ì—…ë°ì´íŠ¸
// 4. ì‚­ì œëœ íšŒì› ìë™ ì œê±°
```

**í”„ë¡œì„¸ìŠ¤:**
```
Supabase (ìµœì‹ ) â†’ LocalStorage (ìºì‹œ)
- ì„œë²„ì—ë§Œ ìˆëŠ” íšŒì›: ì¶”ê°€
- ì„œë²„ì— ì—†ëŠ” íšŒì›: ì‚­ì œ
- ì¤‘ë³µ ë°©ì§€: ID ê¸°ì¤€ ë³‘í•©
```

#### B. ì‚¬ìš©ì í•™ìŠµ ë°ì´í„° ë™ê¸°í™”

```typescript
syncUserDataFromSupabase(userId)
// 1. ì˜¤ë‹µ ë…¸íŠ¸ ë³‘í•©
// 2. ì‹œí—˜ ê²°ê³¼ ë³‘í•©
// 3. í†µê³„ ë°ì´í„° ë™ê¸°í™”
```

**ë³‘í•© ë¡œì§:**
```typescript
// ì˜¤ë‹µ ë…¸íŠ¸
const mergedWrongAnswers = [...serverWrongAnswers];
for (const localWA of localWrongAnswers) {
  if (!existsInServer) {
    mergedWrongAnswers.push(localWA); // ìƒˆë¡œìš´ ì˜¤ë‹µ ì¶”ê°€
  }
}

// ì‹œí—˜ ê²°ê³¼
const mergedResults = [...serverExamResults];
// ë¡œì»¬ì—ë§Œ ìˆëŠ” ê²°ê³¼ ì¶”ê°€
// ìµœì‹ ìˆœ ì •ë ¬ í›„ ìµœê·¼ 100ê°œë§Œ ìœ ì§€
mergedResults.sort((a, b) => b.timestamp - a.timestamp);
saveExamResults(mergedResults.slice(0, 100));

// í†µê³„
saveStatistics(serverData.statistics); // ì„œë²„ ìš°ì„ 
```

### 3. ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥

```typescript
// ì´ì¤‘ ì €ì¥
addLoginHistory(member.id, member.name);        // LocalStorage
await saveLoginHistory(member.id, member.name); // Supabase
```

**ë°ì´í„° êµ¬ì¡°:**
```typescript
{
  id: number,
  userId: number,
  userName: string,
  timestamp: number,
  device: string,      // PC/ìŠ¤ë§ˆíŠ¸í°/íƒœë¸”ë¦¿
  userAgent?: string
}
```

### 4. ì´ì „ ì‹œí—˜ ë³µì›

```typescript
// í˜„ì¬ ì‚¬ìš©ìì˜ ì„¸ì…˜ë§Œ ë³µì›
const currentSession = getCurrentExamSession();

if (currentSession && currentSession.userId === member.id) {
  // "ì´ì „ì— í’€ë˜ ì‹œí—˜ì´ ìˆìŠµë‹ˆë‹¤!" íŒì—…
  // âœ… í™•ì¸: ì´ì „ ì‹œí—˜ ì´ì–´ì„œ í’€ê¸°
  // âŒ ì·¨ì†Œ: ìƒˆë¡œìš´ ì‹œí—˜ ì‹œì‘
}

// ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì„¸ì…˜ì´ë©´ ì‚­ì œ
if (currentSession && currentSession.userId !== member.id) {
  clearCurrentExamSession();
}
```

---

## ğŸ”„ ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤

```mermaid
graph TD
    A[ì‚¬ìš©ì ì…ë ¥] --> B{ì…ë ¥ ê²€ì¦}
    B -->|ì‹¤íŒ¨| C[ì—ëŸ¬ ë©”ì‹œì§€]
    B -->|ì„±ê³µ| D[Supabase íšŒì› ë™ê¸°í™”]
    D --> E{íšŒì› ì°¾ê¸°}
    E -->|ì‹¤íŒ¨| F[ë“±ë¡ ì•ˆë‚´ ë©”ì‹œì§€]
    E -->|ì„±ê³µ| G[ë¡œê·¸ì¸ ì„±ê³µ]
    G --> H[ì‚¬ìš©ì í•™ìŠµ ë°ì´í„° ë™ê¸°í™”]
    H --> I[ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥]
    I --> J{ì´ì „ ì‹œí—˜ ì„¸ì…˜?}
    J -->|ìˆìŒ| K[ë³µì› íŒì—…]
    J -->|ì—†ìŒ| L[í™ˆ í™”ë©´]
    K -->|ì´ì–´í•˜ê¸°| M[ì‹œí—˜ í™”ë©´]
    K -->|ìƒˆë¡œì‹œì‘| L
```

---

## ğŸ“Š State ê´€ë¦¬

```typescript
const [input, setInput] = useState('');           // ì‚¬ìš©ì ì…ë ¥
const [error, setError] = useState<string | null>(null);  // ì—ëŸ¬ ë©”ì‹œì§€
const [loading, setLoading] = useState(false);    // ë¡œë”© ìƒíƒœ
```

---

## ğŸ¨ UI/UX

### ì…ë ¥ í•„ë“œ

```typescript
<input
  type="text"
  placeholder="í™ê¸¸ë™ ë˜ëŠ” 010-1234-5678 ë˜ëŠ” example@email.com"
  autoFocus
  onKeyPress={e => e.key === 'Enter' && handleLogin()}
/>
```

**íŒíŠ¸ ë©”ì‹œì§€:**
```
ğŸ’¡ ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼ ì£¼ì†Œ ì¤‘ í•˜ë‚˜ë§Œ ì…ë ¥í•˜ì„¸ìš”.
```

### ì—ëŸ¬ í‘œì‹œ

```typescript
{error && (
  <div className="bg-red-50 border-l-4 border-red-500">
    <p className="text-red-800 whitespace-pre-line">{error}</p>
  </div>
)}
```

### ë²„íŠ¼ ìƒíƒœ

```typescript
<button
  disabled={loading}
  className={loading ? 'bg-blue-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'}
>
  {loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ğŸ”‘ ë¡œê·¸ì¸'}
</button>
```

---

## ğŸ” ì´ˆê¸°í™” ë° ë™ê¸°í™”

### í˜ì´ì§€ ë¡œë“œ ì‹œ

```typescript
useEffect(() => {
  initializeData();                  // ê¸°ë³¸ ë°ì´í„° ì´ˆê¸°í™”
  syncMembersFromSupabase();        // íšŒì› ëª©ë¡ ë™ê¸°í™”
}, []);
```

### ë¡œê·¸ì¸ ì‹œ

```typescript
1. Supabaseì—ì„œ ìµœì‹  íšŒì› ì •ë³´ ë™ê¸°í™”
2. íšŒì› ì°¾ê¸° (ì´ë¦„/ì „í™”ë²ˆí˜¸/ì´ë©”ì¼)
3. ë¡œê·¸ì¸ ì„±ê³µ â†’ ì‚¬ìš©ì ì„¤ì •
4. ì‚¬ìš©ì í•™ìŠµ ë°ì´í„° ë™ê¸°í™”
5. ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ (LocalStorage + Supabase)
6. ì´ì „ ì‹œí—˜ ì„¸ì…˜ í™•ì¸
7. í™ˆ í™”ë©´ ë˜ëŠ” ì‹œí—˜ í™”ë©´ ì´ë™
```

---

## ğŸ¯ ì—ëŸ¬ ì²˜ë¦¬

### 1. ì…ë ¥ê°’ ì—†ìŒ

```typescript
if (!input.trim()) {
  setError('ì´ë¦„, ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  return;
}
```

### 2. íšŒì› ì—†ìŒ

```typescript
if (!member) {
  if (allMembers.length === 0) {
    setError('ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤. íšŒì›ê°€ì…ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”.');
  } else {
    setError(`ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ìš©ìì…ë‹ˆë‹¤.\n\nì…ë ¥í•œ ê°’: "${trimmedInput}"\n\nâ€» ì´ë¦„, ì „í™”ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼ ì£¼ì†Œ ì¤‘ í•˜ë‚˜ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.\nâ€» íšŒì›ê°€ì…ì´ í•„ìš”í•˜ì‹œë©´ ì•„ë˜ 'íšŒì›ê°€ì…' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`);
  }
  return;
}
```

### 3. ë™ê¸°í™” ì‹¤íŒ¨

```typescript
// Supabase ë™ê¸°í™” ì‹¤íŒ¨í•´ë„ ë¡œê·¸ì¸ì€ ì§„í–‰
try {
  await syncMembersFromSupabase();
} catch (err) {
  console.warn('âš ï¸ Supabase íšŒì› ë™ê¸°í™” ì‹¤íŒ¨:', err);
  // ë¡œê·¸ì¸ ê³„ì† ì§„í–‰
}

// ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨í•´ë„ ë¡œê·¸ì¸ì€ ì§„í–‰
try {
  await saveLoginHistory(member.id, member.name);
} catch (err) {
  console.warn('âš ï¸ Supabase ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ ì˜¤ë¥˜:', err);
  // ë¡œê·¸ì¸ ê³„ì† ì§„í–‰
}
```

---

## ğŸš€ ì„±ëŠ¥ ìµœì í™”

### 1. íšŒì› ëª©ë¡ ë³‘í•©

```typescript
// Supabaseë¥¼ source of truthë¡œ ì‚¬ìš©
const mergedMembers = supabaseMembers.map(sMember => ({
  id: sMember.id,
  name: sMember.name,
  phone: sMember.phone,
  email: sMember.email,
  address: sMember.address,
  registeredAt: sMember.registeredAt,
  memo: sMember.memo || ''
}));

// ë¡œì»¬ì—ë§Œ ìˆëŠ” íšŒì› ìë™ ì œê±°
const removedMembers = localMembers.filter(m => !supabaseIds.has(m.id));
```

### 2. í•™ìŠµ ë°ì´í„° ë³‘í•©

```typescript
// ì˜¤ë‹µ ë…¸íŠ¸: ì„œë²„ ìš°ì„ , ë¡œì»¬ ì¶”ê°€
const mergedWrongAnswers = [...serverWrongAnswers];
for (const localWA of localWrongAnswers) {
  if (!existsInServer) {
    mergedWrongAnswers.push(localWA);
  }
}

// ì‹œí—˜ ê²°ê³¼: ìµœì‹  100ê°œë§Œ ìœ ì§€
mergedResults.sort((a, b) => b.timestamp - a.timestamp);
saveExamResults(mergedResults.slice(0, 100));
```

---

## ğŸ’¡ í•µì‹¬ íŠ¹ì§•

### 1. ê°„í¸í•œ ì¸ì¦

- âœ… ë¹„ë°€ë²ˆí˜¸ ì—†ìŒ
- âœ… ì´ë¦„/ì „í™”ë²ˆí˜¸/ì´ë©”ì¼ ì¤‘ í•˜ë‚˜ë§Œ
- âœ… ì—”í„°í‚¤ ì§€ì›

### 2. ë°ì´í„° ë™ê¸°í™”

- âœ… Supabase â†” LocalStorage ì–‘ë°©í–¥
- âœ… ì„œë²„ ìš°ì„  ë³‘í•©
- âœ… ì‹¤íŒ¨í•´ë„ ë¡œê·¸ì¸ ì§„í–‰

### 3. ì„¸ì…˜ ê´€ë¦¬

- âœ… ì‚¬ìš©ìë³„ ì„¸ì…˜ ë¶„ë¦¬
- âœ… ì´ì „ ì‹œí—˜ ë³µì› ì˜µì…˜
- âœ… ë‹¤ë¥¸ ì‚¬ìš©ì ì„¸ì…˜ ìë™ ì‚­ì œ

### 4. ì˜¤í”„ë¼ì¸ ì§€ì›

- âœ… LocalStorage ìºì‹±
- âœ… Supabase ì‹¤íŒ¨ ì‹œ fallback
- âœ… ë¡œê·¸ì¸ ê¸°ë¡ ì´ì¤‘ ì €ì¥

---

## ğŸ”— ì—°ê²°ëœ í˜ì´ì§€

```typescript
interface LoginProps {
  onLoginSuccess: () => void;      // ë¡œê·¸ì¸ ì„±ê³µ â†’ Home
  onResumeExam?: () => void;       // ì´ì „ ì‹œí—˜ ë³µì› â†’ Exam
  onGoToRegister?: () => void;     // íšŒì›ê°€ì… â†’ Register
}
```

---

## ğŸ“ ë¡œê·¸ ì¶œë ¥

```typescript
// ë¡œê·¸ì¸ ì‹œë„
console.log('ğŸ” ë¡œê·¸ì¸ ì‹œë„:', { input: trimmedInput });

// ë¡œê·¸ì¸ ì„±ê³µ
console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', member.name, '(ID:', member.id + ')');

// íšŒì› ë™ê¸°í™”
console.log(`âœ… íšŒì› ëª©ë¡ ë™ê¸°í™” ì™„ë£Œ: ${supabaseMembers.length}ëª… (ì„œë²„ ê¸°ì¤€)`);

// í•™ìŠµ ë°ì´í„° ë™ê¸°í™”
console.log(`âœ… ì‚¬ìš©ì í•™ìŠµ ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ: ì˜¤ë‹µ ${mergedWrongAnswers.length}ê°œ, ì‹œí—˜ ${mergedResults.length}ê°œ`);
```

---

**ë¶„ì„ ì™„ë£Œ ì¼ì‹œ:** 2025-12-02 20:52:57 (KST)
